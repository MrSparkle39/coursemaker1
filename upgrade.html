<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Upgrade Plan · CourseMaker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass{backdrop-filter:blur(12px);background:rgba(15,23,42,.55)}
    .badge{display:inline-flex;align-items:center;gap:.4rem;font-size:.72rem;padding:.25rem .5rem;border-radius:.6rem;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.05)}
    .plan-card {
      transition: all 0.2s ease;
      background: rgba(30, 41, 59, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .plan-card:hover {
      transform: translateY(-4px);
      border-color: rgba(56, 189, 248, 0.3);
    }
    .plan-card.featured {
      border-color: rgba(56, 189, 248, 0.4);
      background: rgba(6, 182, 212, 0.05);
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100">
  
  <!-- Navigation -->
  <header class="sticky top-0 z-40 border-b border-white/5 glass">
    <nav class="mx-auto flex max-w-7xl items-center justify-between px-4 py-3 md:px-6">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-2xl bg-cyan-500/20 grid place-items-center ring-1 ring-cyan-400/40">✨</div>
        <span class="text-xl font-semibold tracking-tight">CourseMaker</span>
      </div>
      <div class="hidden md:flex items-center gap-8 text-sm text-slate-300">
        <a class="hover:text-white" href="/dashboard.html">Dashboard</a>
        <a class="hover:text-white" href="/courses.html">My Courses</a>
        <a class="hover:text-white" href="/usage.html">Usage</a>
        <a class="hover:text-white" href="/account.html">Account</a>
      </div>
      <div class="flex items-center gap-3">
        <div class="hidden md:flex items-center gap-2">
          <span class="badge" id="userPlan">Pro Plan</span>
          <span class="text-sm text-slate-400" id="userEmail">user@example.com</span>
        </div>
        <button id="btnLogout" class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm hover:bg-white/10">Sign out</button>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <div class="mx-auto max-w-7xl px-4 py-8 md:px-6">
    
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold tracking-tight mb-4">Upgrade Your Plan</h1>
      <p class="text-xl text-slate-400 max-w-2xl mx-auto">Unlock more features and create unlimited professional courses with AI narration</p>
      
      <!-- Toggle -->
      <div class="flex items-center justify-center gap-3 mt-8">
        <span class="text-sm text-slate-300">Monthly</span>
        <button id="billingToggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-slate-600 transition-colors focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2">
          <span id="toggleSwitch" class="inline-block h-4 w-4 transform rounded-full bg-white transition translate-x-1"></span>
        </button>
        <span class="text-sm text-slate-300">Annual <span class="text-cyan-400">(Save 2 months)</span></span>
      </div>
    </div>

    <!-- Current Plan Alert -->
    <div id="currentPlanAlert" class="mb-8 rounded-2xl border border-cyan-400/40 bg-cyan-500/10 p-6 text-center">
      <div class="text-cyan-400 text-sm font-medium">Current Plan</div>
      <div class="text-white text-lg font-semibold mt-1" id="currentPlanName">Pro Plan</div>
      <div class="text-slate-300 text-sm mt-1">You're currently on this plan</div>
    </div>

    <!-- Pricing Plans -->
    <div class="grid gap-8 lg:grid-cols-3 mb-12">
      
      <!-- Free Plan -->
      <div class="plan-card rounded-2xl p-8">
        <div class="text-center mb-6">
          <h3 class="text-2xl font-bold text-white">Free</h3>
          <div class="mt-4">
            <span class="text-4xl font-bold text-white">$0</span>
            <span class="text-slate-400 ml-1">/month</span>
          </div>
          <p class="text-slate-400 mt-2">Perfect for testing</p>
        </div>
        
        <ul class="space-y-3 mb-8">
          <li class="flex items-center text-sm">
            <span class="text-red-400 mr-3">✕</span>
            <span class="text-slate-400">1 course maximum</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-red-400 mr-3">✕</span>
            <span class="text-slate-400">5 slides per course</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-red-400 mr-3">✕</span>
            <span class="text-slate-400">No AI voices</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-green-400 mr-3">✓</span>
            <span class="text-slate-300">PowerPoint conversion</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-red-400 mr-3">✕</span>
            <span class="text-slate-400">Course sharing</span>
          </li>
        </ul>
        
        <button id="btnFreePlan" class="w-full rounded-xl border border-white/10 bg-white/5 px-6 py-3 font-medium hover:bg-white/10" disabled>
          Current Plan
        </button>
      </div>

      <!-- Pro Plan -->
      <div class="plan-card featured rounded-2xl p-8 relative">
        <div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
          <span class="bg-cyan-500 text-slate-900 px-4 py-1 rounded-full text-sm font-medium">Most Popular</span>
        </div>
        
        <div class="text-center mb-6">
          <h3 class="text-2xl font-bold text-white">Pro</h3>
          <div class="mt-4">
            <span class="text-4xl font-bold text-white" id="proPrice">$29</span>
            <span class="text-slate-400 ml-1" id="proPeriod">/month</span>
          </div>
          <p class="text-slate-400 mt-2">For course creators</p>
        </div>
        
        <ul class="space-y-3 mb-8">
          <li class="flex items-center text-sm">
            <span class="text-green-400 mr-3">✓</span>
            <span class="text-slate-300">Unlimited courses</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-green-400 mr-3">✓</span>
            <span class="text-slate-300">200 slides per course</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-green-400 mr-3">✓</span>
            <span class="text-slate-300">Neural2 AI voices (8 voices)</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-green-400 mr-3">✓</span>
            <span class="text-slate-300">100,000 TTS characters/month</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-green-400 mr-3">✓</span>
            <span class="text-slate-300">Course sharing & analytics</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-green-400 mr-3">✓</span>
            <span class="text-slate-300">Email support</span>
          </li>
        </ul>
        
        <button id="btnProPlan" class="w-full rounded-xl bg-cyan-500 px-6 py-3 font-medium text-slate-900 hover:bg-cyan-400">
          Upgrade to Pro
        </button>
      </div>

      <!-- Business Plan -->
      <div class="plan-card rounded-2xl p-8">
        <div class="text-center mb-6">
          <h3 class="text-2xl font-bold text-white">Business</h3>
          <div class="mt-4">
            <span class="text-4xl font-bold text-white" id="businessPrice">$79</span>
            <span class="text-slate-400 ml-1" id="businessPeriod">/month</span>
          </div>
          <p class="text-slate-400 mt-2">For teams & organizations</p>
        </div>
        
        <ul class="space-y-3 mb-8">
          <li class="flex items-center text-sm">
            <span class="text-purple-400 mr-3">✓</span>
            <span class="text-slate-300">Everything in Pro</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-purple-400 mr-3">✓</span>
            <span class="text-slate-300">Unlimited slides per course</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-purple-400 mr-3">✓</span>
            <span class="text-slate-300">Chirp3 HD voices (30 voices)</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-purple-400 mr-3">✓</span>
            <span class="text-slate-300">500,000 TTS characters/month</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-purple-400 mr-3">✓</span>
            <span class="text-slate-300">Team collaboration</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-purple-400 mr-3">✓</span>
            <span class="text-slate-300">White-label branding</span>
          </li>
          <li class="flex items-center text-sm">
            <span class="text-purple-400 mr-3">✓</span>
            <span class="text-slate-300">Priority support & SLA</span>
          </li>
        </ul>
        
        <button id="btnBusinessPlan" class="w-full rounded-xl border border-purple-400/40 bg-purple-500/10 text-purple-300 px-6 py-3 font-medium hover:bg-purple-500/20">
          Upgrade to Business
        </button>
      </div>
    </div>

    <!-- Feature Comparison -->
    <div class="rounded-2xl border border-white/10 bg-white/5 p-8 mb-12">
      <h2 class="text-2xl font-bold text-center mb-8">Compare All Features</h2>
      
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-white/10">
              <th class="text-left py-4 text-slate-300 font-medium">Feature</th>
              <th class="text-center py-4 text-slate-300 font-medium">Free</th>
              <th class="text-center py-4 text-cyan-300 font-medium">Pro</th>
              <th class="text-center py-4 text-purple-300 font-medium">Business</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">Courses</td>
              <td class="py-4 text-center text-slate-400">1</td>
              <td class="py-4 text-center text-cyan-300">Unlimited</td>
              <td class="py-4 text-center text-purple-300">Unlimited</td>
            </tr>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">Slides per course</td>
              <td class="py-4 text-center text-slate-400">5</td>
              <td class="py-4 text-center text-cyan-300">200</td>
              <td class="py-4 text-center text-purple-300">Unlimited</td>
            </tr>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">TTS Characters/month</td>
              <td class="py-4 text-center text-slate-400">0</td>
              <td class="py-4 text-center text-cyan-300">100,000</td>
              <td class="py-4 text-center text-purple-300">500,000</td>
            </tr>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">AI Voices</td>
              <td class="py-4 text-center text-red-400">✕</td>
              <td class="py-4 text-center text-cyan-300">Neural2 (8)</td>
              <td class="py-4 text-center text-purple-300">Neural2 + Chirp3 (38)</td>
            </tr>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">Course sharing</td>
              <td class="py-4 text-center text-red-400">✕</td>
              <td class="py-4 text-center text-green-400">✓</td>
              <td class="py-4 text-center text-green-400">✓</td>
            </tr>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">Analytics & tracking</td>
              <td class="py-4 text-center text-red-400">✕</td>
              <td class="py-4 text-center text-green-400">✓</td>
              <td class="py-4 text-center text-green-400">✓</td>
            </tr>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">Team collaboration</td>
              <td class="py-4 text-center text-red-400">✕</td>
              <td class="py-4 text-center text-red-400">✕</td>
              <td class="py-4 text-center text-green-400">✓</td>
            </tr>
            <tr class="border-b border-white/5">
              <td class="py-4 text-slate-300">White-label branding</td>
              <td class="py-4 text-center text-red-400">✕</td>
              <td class="py-4 text-center text-red-400">✕</td>
              <td class="py-4 text-center text-green-400">✓</td>
            </tr>
            <tr>
              <td class="py-4 text-slate-300">Support</td>
              <td class="py-4 text-center text-slate-400">Community</td>
              <td class="py-4 text-center text-cyan-300">Email</td>
              <td class="py-4 text-center text-purple-300">Priority + SLA</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- FAQ -->
    <div class="rounded-2xl border border-white/10 bg-white/5 p-8 mb-12">
      <h2 class="text-2xl font-bold text-center mb-8">Frequently Asked Questions</h2>
      
      <div class="grid gap-6 md:grid-cols-2">
        <div>
          <h3 class="font-semibold text-white mb-2">Can I change plans anytime?</h3>
          <p class="text-slate-400 text-sm">Yes, you can upgrade or downgrade your plan at any time. Changes take effect at your next billing cycle.</p>
        </div>
        
        <div>
          <h3 class="font-semibold text-white mb-2">What happens to my courses if I downgrade?</h3>
          <p class="text-slate-400 text-sm">Your existing courses remain accessible, but you'll be limited by your new plan's restrictions for creating new content.</p>
        </div>
        
        <div>
          <h3 class="font-semibold text-white mb-2">Do you offer refunds?</h3>
          <p class="text-slate-400 text-sm">We offer a 30-day money-back guarantee on all paid plans. Contact support for assistance.</p>
        </div>
        
        <div>
          <h3 class="font-semibold text-white mb-2">What payment methods do you accept?</h3>
          <p class="text-slate-400 text-sm">We accept all major credit cards, PayPal, and bank transfers for annual plans.</p>
        </div>
        
        <div>
          <h3 class="font-semibold text-white mb-2">Is there a setup fee?</h3>
          <p class="text-slate-400 text-sm">No setup fees. You only pay the monthly or annual subscription fee.</p>
        </div>
        
        <div>
          <h3 class="font-semibold text-white mb-2">Can I cancel anytime?</h3>
          <p class="text-slate-400 text-sm">Yes, you can cancel your subscription at any time. Your access continues until the end of your billing period.</p>
        </div>
      </div>
    </div>

    <!-- Support -->
    <div class="text-center">
      <h2 class="text-2xl font-bold mb-4">Need Help Choosing?</h2>
      <p class="text-slate-400 mb-6">Our team is here to help you find the perfect plan for your needs.</p>
      
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="mailto:support@coursemaker.app" class="rounded-xl border border-white/10 bg-white/5 px-6 py-3 font-medium hover:bg-white/10">
          Contact Sales
        </a>
        <a href="/help" class="rounded-xl border border-white/10 bg-white/5 px-6 py-3 font-medium hover:bg-white/10">
          View Documentation
        </a>
      </div>
    </div>

  </div>

  <script>
    let currentUser = null;
    let isAnnual = false;

    // Pricing
    const MONTHLY_PRICES = { pro: 29, business: 79 };
    const ANNUAL_PRICES = { pro: 290, business: 790 }; // 10 months price for 12 months

    // Initialize page
    document.addEventListener('DOMContentLoaded', async () => {
      await loadUserData();
      setupEventListeners();
      updatePricing();
    });

    // Load user data
    async function loadUserData() {
      try {
        const response = await fetch('/api/user/profile', {
          credentials: 'include'
        });
        
        if (response.ok) {
          currentUser = await response.json();
          updateUserInterface();
        } else {
          window.location.href = '/login.html';
        }
      } catch (error) {
        console.error('Error loading user data:', error);
        window.location.href = '/login.html';
      }
    }

    // Update UI with user data
    function updateUserInterface() {
      if (!currentUser) return;
      
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userPlan').textContent = currentUser.planType.charAt(0).toUpperCase() + currentUser.planType.slice(1) + ' Plan';
      
      // Update plan badge color
      const planBadge = document.getElementById('userPlan');
      if (currentUser.planType === 'pro') {
        planBadge.className = 'badge text-cyan-300 border-cyan-400/40 bg-cyan-500/20';
      } else if (currentUser.planType === 'business') {
        planBadge.className = 'badge text-purple-300 border-purple-400/40 bg-purple-500/20';
      } else {
        planBadge.className = 'badge text-slate-300 border-slate-400/40 bg-slate-500/20';
      }

      // Update current plan alert
      const planNames = {
        'free': 'Free Plan',
        'pro': 'Pro Plan',
        'business': 'Business Plan'
      };
      document.getElementById('currentPlanName').textContent = planNames[currentUser.planType];

      // Update button states
      updateButtonStates();
    }

    // Update button states based on current plan
    function updateButtonStates() {
      const freeBtn = document.getElementById('btnFreePlan');
      const proBtn = document.getElementById('btnProPlan');
      const businessBtn = document.getElementById('btnBusinessPlan');

      // Reset all buttons
      freeBtn.disabled = false;
      proBtn.disabled = false;
      businessBtn.disabled = false;
      
      freeBtn.textContent = 'Downgrade to Free';
      proBtn.textContent = 'Upgrade to Pro';
      businessBtn.textContent = 'Upgrade to Business';

      // Update based on current plan
      switch (currentUser.planType) {
        case 'free':
          freeBtn.disabled = true;
          freeBtn.textContent = 'Current Plan';
          break;
        case 'pro':
          proBtn.disabled = true;
          proBtn.textContent = 'Current Plan';
          proBtn.className = 'w-full rounded-xl border border-cyan-400/40 bg-cyan-500/10 text-cyan-300 px-6 py-3 font-medium';
          businessBtn.textContent = 'Upgrade to Business';
          break;
        case 'business':
          businessBtn.disabled = true;
          businessBtn.textContent = 'Current Plan';
          businessBtn.className = 'w-full rounded-xl border border-purple-400/40 bg-purple-500/10 text-purple-300 px-6 py-3 font-medium';
          proBtn.textContent = 'Downgrade to Pro';
          break;
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      document.getElementById('btnLogout').addEventListener('click', logout);
      
      // Billing toggle
      document.getElementById('billingToggle').addEventListener('click', toggleBilling);
      
      // Plan buttons
      document.getElementById('btnFreePlan').addEventListener('click', () => changePlan('free'));
      document.getElementById('btnProPlan').addEventListener('click', () => changePlan('pro'));
      document.getElementById('btnBusinessPlan').addEventListener('click', () => changePlan('business'));
    }

    // Toggle between monthly and annual billing
    function toggleBilling() {
      isAnnual = !isAnnual;
      
      const toggle = document.getElementById('billingToggle');
      const toggleSwitch = document.getElementById('toggleSwitch');
      
      if (isAnnual) {
        toggle.classList.add('bg-cyan-500');
        toggle.classList.remove('bg-slate-600');
        toggleSwitch.classList.add('translate-x-6');
        toggleSwitch.classList.remove('translate-x-1');
      } else {
        toggle.classList.remove('bg-cyan-500');
        toggle.classList.add('bg-slate-600');
        toggleSwitch.classList.remove('translate-x-6');
        toggleSwitch.classList.add('translate-x-1');
      }
      
      updatePricing();
    }

    // Update pricing display
    function updatePricing() {
      const prices = isAnnual ? ANNUAL_PRICES : MONTHLY_PRICES;
      const period = isAnnual ? '/year' : '/month';
      
      document.getElementById('proPrice').textContent = `${prices.pro}`;
      document.getElementById('proPeriod').textContent = period;
      document.getElementById('businessPrice').textContent = `${prices.business}`;
      document.getElementById('businessPeriod').textContent = period;
    }

    // Change plan
    async function changePlan(newPlan) {
      if (newPlan === currentUser.planType) {
        return; // Already on this plan
      }

      const planNames = {
        'free': 'Free',
        'pro': 'Pro', 
        'business': 'Business'
      };

      const isUpgrade = (currentUser.planType === 'free' && newPlan !== 'free') ||
                       (currentUser.planType === 'pro' && newPlan === 'business');
      
      const action = isUpgrade ? 'upgrade' : 'downgrade';
      const message = `Are you sure you want to ${action} to the ${planNames[newPlan]} plan?`;
      
      if (!confirm(message)) {
        return;
      }

      try {
        const response = await fetch('/api/user/change-plan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ 
            newPlan, 
            billing: isAnnual ? 'annual' : 'monthly' 
          })
        });
        
        if (response.ok) {
          const result = await response.json();
          
          if (result.requiresPayment) {
            // Redirect to payment page
            window.location.href = result.paymentUrl;
          } else {
            alert(`Successfully ${action}d to ${planNames[newPlan]} plan!`);
            await loadUserData(); // Refresh user data
          }
        } else {
          const error = await response.json();
          alert(`Failed to ${action}: ` + error.error);
        }
      } catch (error) {
        console.error('Plan change error:', error);
        alert(`Failed to ${action} plan`);
      }
    }

    async function logout() {
      try {
        await fetch('/api/auth/logout', {
          method: 'POST',
          credentials: 'include'
        });
      } catch (error) {
        console.error('Logout error:', error);
      } finally {
        window.location.href = '/login.html';
      }
    }
  </script>

  <!-- Universal Footer will be inserted here by universal-footer.js -->
  <div class="universal-footer-placeholder"></div>

  <!-- Universal Footer Script -->
  <script src="universal-footer.js"></script>
</body>
</html>